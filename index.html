<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Kegeln mit die Boys - Strafen</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Kegeln">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root { --bg:#111; --card:#222; --card2:#1b1b1b; --btn:#444; --ok:#28a745; --bad:#a83232; --line:#333; --muted:#aaa; }
    body { font-family: Arial, sans-serif; background: var(--bg); color:#fff; margin:0; padding: 15px; }
    .topbar { display:flex; align-items:center; gap:12px; justify-content:center; margin: 6px 0 16px; }
    .topbar img { width:52px; height:52px; border-radius:14px; background: var(--bg); box-shadow: 0 4px 18px rgba(0,0,0,.25); }
    h1 { margin:0; text-align:center; font-size:20px; line-height:1.2; }
    h2 { text-align:center; margin:0 0 10px; }

    .add-player { display:flex; gap:10px; margin: 14px 0 20px; }
    input { flex:1; padding:12px; font-size:16px; border-radius:12px; border:none; outline:none; }
    button { padding:12px; font-size:16px; border-radius:12px; border:none; cursor:pointer; }
    .add-btn { background: var(--ok); color:#fff; min-width: 120px; }

    .player { background: var(--card); padding:15px; border-radius:16px; margin-bottom:14px; }
    .player-name { font-size:18px; margin-bottom:10px; font-weight:bold; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; }
    .controls button { flex:1; min-width:110px; background: var(--btn); color:#fff; }
    .correction { background: var(--bad) !important; }
    .amount { margin-top:10px; font-size:16px; font-weight:bold; }

    .evaluation { background: var(--card2); padding:15px; border-radius:16px; margin-top:24px; }
    .eval-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--line); }
    .muted { color: var(--muted); text-align:center; margin: 8px 0 0; font-size: 13px; line-height: 1.3; }
  </style>
</head>

<body>
  <div class="topbar">
    <img src="icons/icon-192.png" alt="Kegeln mit die Boys Icon">
    <h1>Kegeln mit die Boys - Strafen</h1>
  </div>

  <div class="add-player">
    <input type="text" id="nameInput" placeholder="Name eingeben" autocomplete="off" inputmode="text">
    <button class="add-btn" id="addBtn">Hinzufügen</button>
  </div>

  <div id="players"></div>

  <div class="evaluation">
    <h2>Auswertung – Meiste Strafen zuerst</h2>
    <div id="evaluationList"></div>
    <div class="muted">iPhone-Tipp: Öffne die Seite in Safari → Teilen → „Zum Home-Bildschirm“.</div>
  </div>

  <script>
    // --- DOM sicher holen (wichtig für iPhone/Safari) ---
    const nameInput = document.getElementById("nameInput");
    const addBtn = document.getElementById("addBtn");
    const playersDiv = document.getElementById("players");
    const evaluationList = document.getElementById("evaluationList");

    // --- Geld als CENTS (Integer) speichern: 10, 50, 100 ---
    const STORAGE_KEY = "kegeln_players_v1";
    let players = loadPlayers();

    function loadPlayers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const parsed = raw ? JSON.parse(raw) : [];
        return parsed.map(p => ({
          name: String(p.name ?? "").trim(),
          cents: Number.isInteger(p.cents) ? p.cents : Math.round((Number(p.amount) || 0) * 100)
        })).filter(p => p.name.length > 0);
      } catch {
        return [];
      }
    }

    function savePlayers() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
    }

    function centsToEuro(cents) {
      return (cents / 100).toFixed(2) + " €";
    }

    function addPlayer() {
      const name = nameInput.value.trim();
      if (!name) return;

      players.push({ name, cents: 0 });
      nameInput.value = "";
      savePlayers();
      render();
    }

    function updateCents(index, delta) {
      players[index].cents = Math.max(0, players[index].cents + delta);
      savePlayers();
      render();
    }

    function renderPlayers() {
      playersDiv.innerHTML = "";

      players.forEach((p, i) => {
        const card = document.createElement("div");
        card.className = "player";

        const nameEl = document.createElement("div");
        nameEl.className = "player-name";
        nameEl.textContent = p.name;

        const controls = document.createElement("div");
        controls.className = "controls";

        const b10 = document.createElement("button");
        b10.textContent = "+0,10 €";
        b10.addEventListener("click", () => updateCents(i, 10));

        const b50 = document.createElement("button");
        b50.textContent = "+0,50 €";
        b50.addEventListener("click", () => updateCents(i, 50));

        const b100 = document.createElement("button");
        b100.textContent = "+1,00 €";
        b100.addEventListener("click", () => updateCents(i, 100));

        const corr = document.createElement("button");
        corr.textContent = "Korrektur -0,10 €";
        corr.className = "correction";
        corr.addEventListener("click", () => updateCents(i, -10));

        controls.append(b10, b50, b100, corr);

        const amount = document.createElement("div");
        amount.className = "amount";
        amount.textContent = "Summe: " + centsToEuro(p.cents);

        card.append(nameEl, controls, amount);
        playersDiv.appendChild(card);
      });
    }

    function renderEvaluation() {
      evaluationList.innerHTML = "";
      const sorted = [...players].sort((a, b) => b.cents - a.cents);

      sorted.forEach(p => {
        const row = document.createElement("div");
        row.className = "eval-item";
        row.innerHTML = `<span>${p.name}</span><span>${centsToEuro(p.cents)}</span>`;
        evaluationList.appendChild(row);
      });
    }

    function render() {
      renderPlayers();
      renderEvaluation();
    }

    addBtn.addEventListener("click", addPlayer);
    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addPlayer();
    });

    render();
  </script>

  <script>
    // PWA: Service Worker registrieren
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>
</body>
</html>
